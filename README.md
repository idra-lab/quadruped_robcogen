# quadruped_robcogen

This package allows to generate the C++ [RobCoGen](https://robcogenteam.bitbucket.io/) code for any quadruped robot
with 12 active DoF. The code includes forward/inverse kinematics and dynamics.

Under the hood the code is generated in three steps:
1. the xacro file is converted into URDF via the standard [`xacro`](http://wiki.ros.org/xacro) command
2. the URDF is converted into a KINDSL file (the RobCoGen robot modelformat) with the [`urdf2kindsl`](https://bitbucket.org/robcogenteam/urdf2kindsl/src/master/) command
3. the `${ROBOT_NAME}.kindsl` model and the transforms file `${ROBOT_NAME}.dtdsl` (where `${ROBOT_NAME}` is the name of your robot) are passed to the RobCoGen executable to make the CPPs

All the above programs are either copied locally into this repo or available from ROS.

## Dependencies
This repository contains a slightly modified copy of the RobCoGen executable (version 5.0.1), which is written in Java. The following dependencies are therefore
required to run the program correctly:
- Java JRE
- ANT
- Ivy
- Maxima
- gcc

On Ubuntu, these can be installed as follows:
```
sudo apt install openjdk-8-jre  ant ivy maxima gcc
```
**NOTE**: Ivy has a faulty installation. 
If you experience problems, you can fix with a symlink:
```
sudo ln -s /usr/share/java/ivy.jar /usr/share/ant/lib/ivy.jar 
```

The generated code also depends on the Rigid Body Dynamics (RBD) interfaces available [as part of the pronto project](https://github.com/ori-drs/pronto/tree/master/pronto_quadruped_commons).  This is a catkinized copy of the original code [here](https://bitbucket.org/robcogenteam/cpp-iitrbd/src/master/).

## The `robcogen` CMake macro
The [robcogen.cmake](cmake/robcogen.cmake) file defines the macro to be used within your custom `CMakeLists.txt` to generate the code for your robot. It takes two arguments:
- `ROBOT_NAME` is the name of your robot, e.g., `fido. 
- `ROBOT_VERSION`(optional) is a convenience variable to have more flexibility on the description package name, e.g. with `2000_`  it would look for the `fido_2000_description` package to find the xacro of your robot. 

## Build the Code for Your Robot
To generate the code for your robot, create a catkin package that depends on 
`quadruped_robcogen` and use the provided the `robcogen` cmake macro to build your code.

Example `CMakeLists.txt` for a robot called `fido`:

```
cmake_minimum_required(VERSION 2.8)
project(fido_robcogen)
add_compile_options(-std=c++11)

find_package(catkin REQUIRED COMPONENTS pronto_quadruped_commons
                                        fido_description
                                        quadruped_robcogen)
include_directories(${catkin_INCLUDE_DIRS})

set(LIB_NAME ${PROJECT_NAME})

find_package(Eigen3)
include_directories(${EIGEN3_INCLUDE_DIRS})

include_directories(./include)
include_directories(./include/${PROJECT_NAME})
include(${quadruped_robcogen_SOURCE_PREFIX}/cmake/robcogen.cmake)

# call the macro to generate the C++ code
robcogen(fido)

install(TARGETS ${LIB_NAME}
        ARCHIVE DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
        LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
        RUNTIME DESTINATION ${CATKIN_GLOBAL_BIN_DESTINATION})

install(DIRECTORY include/${PROJECT_NAME}/
        DESTINATION ${CATKIN_PACKAGE_INCLUDE_DESTINATION})
```

Example `package.xml`:
```
<?xml version="1.0" ?>
<package format="2">
    <name>fido_robcogen</name>
    <version>0.0.1</version>
    <description>
        Kinematics and Dynamics functions for the fido robot generated by 
        the RobCoGen generator
    </description>
    <maintainer email="john.doe@smith.edu">John Doe</maintainer>
    <author email="john.doe@smith.edu">John Doe</author>
    <license>BSD</license>
    <buildtool_depend>catkin</buildtool_depend>    
    <depend>pronto_quadruped_commons</depend>
    <depend>quadruped_robcogen</depend>
    <depend>fido_description</depend>
    <export> </export>
</package>
```
## Limitations
- The `xacro` command is invoked always without arguments
- The transform files assumes the feet are named `LF_FOOT`, `RF_FOOT`, `LH_FOOT` and `RH_FOOT`.
  If you have different names for your end effector, you have to manually change them [here](config/robot.dtdsl).
- it is assumed the description package of the robot is named either `${ROBOT_NAME}_description` or `${ROBOT_NAME}_${ROBOT_VERSION}description`, where `ROBOT_VERSION` is a string of any kind. For example, you might have a description called `fido_2000_description` if `ROBOT_NAME = fido` and `ROBOT_VERSION = 2000_` (note the underscore). 
- The xacro file name is assumed to be named `${ROBOT_NAME}.xacro.urdf`

